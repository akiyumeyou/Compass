# 音声会話機能のセットアップガイド

## 概要

このアプリケーションには2つのモードが実装されています：

1. **テキストモード**（デフォルト）：従来のテキストチャット
2. **Realtimeモード**：OpenAI Realtime APIを使用したリアルタイム音声会話（推奨）

## 環境変数の設定

### OpenAI API Key（必須）
```bash
VITE_OPENAI_API_KEY=your_openai_api_key_here
```

## 音声機能の詳細

### Realtimeモード（OpenAI Realtime API）
- **リアルタイム音声会話**：OpenAIの最新Realtime API（gpt-realtime）を使用
- **自然な音声合成**：より自然で表現豊かな音声
- **低遅延**：リアルタイムでの音声応答
- **子供の声**：voice: "verse"プリセットで子供らしい声を実現
- **WebRTC接続**：ブラウザのWebRTCを使用した高品質音声通信
- **音声認識**：Whisper-1モデルによる高精度音声認識

## 使用方法

### 1. テキストモード
- デフォルトのモード
- テキスト入力でチャット

### 2. Realtimeモード（音声会話）
- ヘッダーの音声アイコンをクリック
- 「音声通話を開始」ボタンをクリック
- マイクの使用許可を与える
- 音声で会話開始
- リアルタイムで音声応答

## ブラウザサポート

### Realtime API（WebRTC）
- Chrome/Edge: 完全サポート
- Firefox: 完全サポート
- Safari: 完全サポート
- WebRTC接続が必要
- HTTPS接続が必要

## トラブルシューティング

### Realtime APIが接続できない
1. OpenAI API Keyが正しく設定されているか確認
2. ネットワーク接続を確認
3. APIの利用制限を確認
4. HTTPS接続を確認

### 音声が聞こえない
1. ブラウザでマイクの使用を許可
2. システムの音量設定を確認
3. 他のアプリケーションが音声を占有していないか確認
4. WebRTC接続が確立されているか確認

### 音声認識が動作しない
1. マイクが正しく接続されているか確認
2. ブラウザでマイクの使用を許可
3. 周囲の騒音レベルを確認
4. ネットワーク接続を確認

## 開発者向け情報

### 音声データの形式
- **Realtime API**: PCM16形式（16kHz）
- **WebRTC**: リアルタイム音声ストリーム

### カスタマイズ
- 音声プリセットは `api/realtime-session.ts` で調整可能
- 音声認識はWhisper-1モデルを使用
- 音声合成はOpenAIのvoice: "verse"プリセットを使用

### 実装詳細
- **サーバー側**: `/api/realtime-session.ts` でセッション作成
- **フロント側**: `components/RealtimeCall.tsx` でWebRTC接続
- **統合**: `components/ChatScreen.tsx` でモード切り替え

## 今後の改善予定

1. **音声品質の向上**：より自然な子供の声の実現
2. **感情表現**：音声に感情を込めた合成
3. **音声エフェクト**：エコーやリバーブの追加
4. **音声学習**：ユーザーの声に合わせた音声調整
5. **多言語対応**：他の言語での音声会話
